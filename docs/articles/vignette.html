<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>_sigQC_: Gene Signature Quality Control • sigQC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="_sigQC_: Gene Signature Quality Control">
<meta property="og:description" content="sigQC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sigQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.21</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette.html">_sigQC_: Gene Signature Quality Control</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewdhawan/sigQC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<em>sigQC</em>: Gene Signature Quality Control</h1>
                        <h4 class="author">Andrew Dhawan</h4>
            
            <h4 class="date">2020-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewdhawan/sigQC/blob/master/vignettes/vignette.Rmd"><code>vignettes/vignette.Rmd</code></a></small>
      <div class="hidden name"><code>vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction-and-sigqc-protocol-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-and-sigqc-protocol-overview" class="anchor"></a>Introduction and <em>sigQC</em> protocol overview</h1>
<p>Inreasing amounts of genomic data mean that gene expression signatures are becoming critically important tools, poised to make a large impact on the diagnosis, management and prognosis for a number of diseases. For the purposes of this package, we define the term <strong>gene signature</strong> to mean: ‘a set of genes whose co-ordinated mRNA expression pattern is representative of a biological pathway, process, or phenotype, or clinical outcome.’</p>
<p>A key issue with gene signatures of this nature is whether the expression of many genes can be summarised as a single score, or whether multiple components are represented. In this package, we have automated the testing of a number of quality control metrics designed to test whether a single score, such as the median or mean, is an appropriate summary for the genes’ expression in a new dataset. Furthermore, the tools in this package enable the visualization of properties of a set of genes in a specific dataset, such as expression profile, variability, correlation, and comparison of methods of standardisation and scoring metrics for wider scope application.s</p>
</div>
<div id="package-installation" class="section level1">
<h1 class="hasAnchor">
<a href="#package-installation" class="anchor"></a>Package installation</h1>
<p>To install the <em>sigQC</em> package, run the following code:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'sigQC'</span>)</pre></body></html></div>
</div>
<div id="general-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#general-overview" class="anchor"></a>General overview</h1>
<p>The <em>sigQC</em> package is designed to be a single function <strong>make_all_plots()</strong>, capable of customising outputs as needed for the user, based on the inputs provided.</p>
<p>The basic inputs are as follows:</p>
<ul>
<li>
<code>gene_sigs_list</code>: A <strong>list</strong> of gene signatures, such that <code>gene_sigs_list[[sig_name]]</code> is a k row x 1 column character matrix for the gene set corresponding to <code>sig_name</code>
</li>
<li>
<code>mRNA_expr_matrix</code>: A <strong>list</strong> of mRNA gene expression matrices, such that <code>mRNA_expr_matrix[[dataset_name]]</code> is a matrix with rows corresponding to genes, and columns to samples, of normalised, batch-corrected, and log-transformed (if needed), mRNA expression values</li>
<li>
<code>names_sigs</code>: (Optional) A <strong>vector</strong> of the names of the elements of <code>gene_sigs_list</code>
</li>
<li>
<code>names_datasets</code>: (Optional) A <strong>vector</strong> of the names of the elements of <code>mRNA_expr_matrix</code>
</li>
<li>
<code>covariates</code>: (Optional) A <strong>list</strong> containing a sub-list of <code>annotations’ and</code>colors’ which contains the annotation matrix for the samples in a given dataset and the associated colours, for plotting in the expression heatmap</li>
<li>
<code>thresholds</code>: (Optional) A <strong>list</strong> of thresholds to be considered for each data set, default is median expression of <em>all genes</em> of a data set. A gene is considered expressed if above the threshold, non-expressed otherwise. One threshold per dataset, in the same order as the dataset list.</li>
<li>
<code>out_dir</code>: (Optional) A <strong>string</strong> specifying the location/name of the directory where outputs should be saved to</li>
<li>
<code>showResults</code>: (Optional) A <strong>boolean</strong> specifying whether to display the output plots in R graphics windows or not</li>
<li>
<code>origin</code>: (Optional) A character <strong>vector</strong> with each character describing the origin of the different datasets (used only in the computation of rank product statistic among autocorrelation matrices, to account for batch effects)</li>
<li>
<code>doNegativeControl</code>: (Optional) A <strong>boolean</strong> specifying whether to do the negative and permutation control bootstrap resampling for each signature/dataset combination; note that if true, it will take significantly longer to run <em>sigQC</em>
</li>
<li>
<code>numResampling</code>: (Optional) A <strong>numeric</strong> value specifying the number of bootstrapping runs to perform for the negative and permutation controls</li>
</ul>
</div>
<div id="sample-workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#sample-workflow" class="anchor"></a>Sample workflow</h1>
<p>The premise behind <em>sigQC</em> is to input primarily two things - the gene signatures and the datasets to test them upon. Once these inputs are prepared in the correct format, the <code>make_all_plots</code> function can be run, with settings as per user needs, generating the quality control plots needed to ascertain how each signature performs on each dataset considered.</p>
<p>Below, we consider the case of two random datasets and random gene signatures, and show how to customise each of the inputs.</p>
<div id="step-1-preparation-of-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-preparation-of-input-data" class="anchor"></a>Step 1: Preparation of input data</h2>
<p>Input data should consist of lists of expression matrices, and should be pre-normalised, batch-corrected, and standardised if required. Care should be taken to ensure that genes of interest are present in the dataset and not reported primarily as NA values. Gene signatures must be annotated in a manner consistent with the input data.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">dataset_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">500</span>,<span class="kw">mean</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">sd</span><span class="kw">=</span><span class="fl">1</span>))<span class="co">#random matrix - 1000 genes x 500 samples</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="no">dataset_1</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dataset_1</span>)[<span class="fl">1</span>])) <span class="co">#set the gene names</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dataset_1</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'d1_'</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dataset_1</span>)[<span class="fl">2</span>]))) <span class="co">#set the sample IDs</span>

<span class="no">dataset_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">250</span>,<span class="kw">mean</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">sd</span><span class="kw">=</span><span class="fl">2</span>))<span class="co">#random matrix - 1000 genes x 250 samples</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="no">dataset_2</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dataset_2</span>)[<span class="fl">1</span>])) <span class="co">#set the gene names</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dataset_2</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'d2_'</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dataset_2</span>)[<span class="fl">2</span>]))) <span class="co">#set the sample IDs</span>

<span class="co">#gene sets that we are going to use for our gene signatures</span>
<span class="no">gene_sig_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>,<span class="st">'5'</span>,<span class="st">'8'</span>,<span class="st">'13'</span>,<span class="st">'21'</span>,<span class="st">'34'</span>,<span class="st">'55'</span>,<span class="st">'89'</span>,<span class="st">'144'</span>,<span class="st">'233'</span>,<span class="st">'377'</span>,<span class="st">'610'</span>,<span class="st">'987'</span>)
<span class="no">gene_sig_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'2'</span>,<span class="st">'4'</span>,<span class="st">'8'</span>,<span class="st">'16'</span>,<span class="st">'32'</span>,<span class="st">'64'</span>,<span class="st">'128'</span>,<span class="st">'256'</span>,<span class="st">'512'</span>)</pre></body></html></div>
<p>Any specific expression thresholds for expression (other than global median) should be computed, as this is the default the package uses as an expression cutoff.</p>
</div>
<div id="step-2-creation-of-input-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-creation-of-input-variables" class="anchor"></a>Step 2: Creation of input variables</h2>
<p>Next, we load the input datasets and gene signatures into list format.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mRNA_expr_matrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">mRNA_expr_matrix</span><span class="kw">[[</span><span class="st">"dataset_1"</span>]] <span class="kw">=</span> <span class="no">dataset_1</span>
<span class="no">mRNA_expr_matrix</span><span class="kw">[[</span><span class="st">"dataset_2"</span>]] <span class="kw">=</span> <span class="no">dataset_2</span>

<span class="no">gene_sigs_list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">gene_sigs_list</span><span class="kw">[[</span><span class="st">'gene_sig_1'</span>]] <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">gene_sig_1</span>)
<span class="no">gene_sigs_list</span><span class="kw">[[</span><span class="st">'gene_sig_2'</span>]] <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">gene_sig_2</span>)</pre></body></html></div>
<p>We then set the other non-default valued input variables as needed for our analysis:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">showResults</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span> <span class="co"># we do not want to show the reuslts in R graphics windows</span>
<span class="no">doNegativeControl</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span> <span class="co"># we do not want to compute the negative or permutation controls for time purposes</span></pre></body></html></div>
</div>
<div id="step-3-running-of-sigqc-package" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-running-of-sigqc-package" class="anchor"></a>Step 3: Running of <em>sigQC</em> package</h2>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"sigQC"</span>)

<span class="fu"><a href="../reference/make_all_plots.html">make_all_plots</a></span>(<span class="no">gene_sigs_list</span>, <span class="no">mRNA_expr_matrix</span>, <span class="kw">showResults</span> <span class="kw">=</span> <span class="no">showResults</span>, <span class="kw">doNegativeControl</span> <span class="kw">=</span> <span class="no">doNegativeControl</span>)</pre></body></html></div>
<p>This will produce, in the desired output directory, a number of plots in PDF files which may be analysed as described in the subsequent steps. The package also creates an output file `log.log’ in the output directory, a text file, which summarises the run, and reports any errors that may have occurred if they are not printed to the console. This should be consulted if any issues are encountered in the running of this principal function and for troubleshooting purposes.</p>
</div>
<div id="step-4-analysis-of-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4-analysis-of-expression" class="anchor"></a>Step 4: Analysis of expression</h2>
<p>Expression of signature genes should be evaluated across samples in all datasets, and this is done by analysis of the plots sig_expr_*.pdf.</p>
<p>These plots describe the proportion of samples with supra-threshold expression of each signature gene (either for the median threshold, or user-specified as above), and the proportion of samples with non-NA values, identifying non-expressed signature components.</p>
<div class="figure">
<img src="sample_plots/sig_expr_barcharts.png" style="width:80.0%" alt=""><p class="caption">Barchart of expression of signature genes above threshold</p>
</div>
</div>
<div id="step-5-analysis-of-variability" class="section level2">
<h2 class="hasAnchor">
<a href="#step-5-analysis-of-variability" class="anchor"></a>Step 5: Analysis of variability</h2>
<p>To check signature gene variability, load the file ‘sig_mean_vs_sd.pdf.’ These plots describe the mean and standard deviation of expression of all genes reported (in grey) versus all signature genes (in red), with corresponding dashed lines over the plots describing the 10th, 25th, 50th, 75th and 90th percentiles of both mean and standard deviation.</p>
<p>This facilitates the easy identification of those signature genes, which are not variable or expressed sufficiently among the samples, as well as a global evaluation of signature behaviour across samples of a dataset.</p>
<div class="figure">
<img src="sample_plots/sig_mean_vs_sd.png" style="width:80.0%" alt=""><p class="caption">Plot of mean vs. standard deviation of signature genes’ expression (red) and all other genes (grey)</p>
</div>
</div>
<div id="step-6-analysis-of-co-correlation-of-scoring-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#step-6-analysis-of-co-correlation-of-scoring-metrics" class="anchor"></a>Step 6: Analysis of co-correlation of scoring metrics</h2>
<p>Next, loading the files called ‘sig_compare_metrics_*.pdf’ it is possible to analyse the co-correlation of mean, median and first principal component (PCA1) as scoring metrics across the samples for each signature across each dataset.</p>
<p>Also shown in the fourth row of panels of these plots is a principal components analysis (PCA) scree plot, which describes the proportion of the variance attributable to each principal component, which may reflect whether the first PCA represents a reasonable scoring summary metric for a particular gene signature.</p>
<div class="figure">
<img src="sample_plots/sig_compare_metrics_gene_sig_1.png" style="width:80.0%" alt=""><p class="caption">Plot of co-correlations and distributions of scoring metrics for gene signature 1 across datasets</p>
</div>
<p>In addition, loading the files called ’sig_compare_ES_metrics_*.pdf’, we provide analogous co-correlation plots for each of GSVA, ssGSEA, and PLAGE scores, also showing the distribution of these scoring metrics. These scores are based on the techniques implemented by the GSVA R package, which is a dependency of <em>sigQC</em>, and the original package and publications by Hanzelman et al., 2013, Barbie et al., 2009, and Tomfohr et al., 2005 should be consulted for details of the calculation of these metrics. As these are enrichment socre-based metrics, these are best used in concert with the quality control for signatures based on enrichment analysis results, such as those from MSigDB.</p>
<p>Also, loading the files called ’scoring_metrics_corr_*.pdf’, one can observe the co-correlation between all of the six scoring metrics considered (mean, median, PCA1, GSVA, ssGSEA, and PLAGE) as a heatmap of Spearman correlation coefficients. Again, this is of particular use for signatures derived based on enrichment analyses.</p>
<div id="analysis-of-normality-of-scoring-metrics" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-of-normality-of-scoring-metrics" class="anchor"></a>Analysis of normality of scoring metrics</h3>
<p>In the files called ’sig_qq_plots_*.pdf.’ we show QQ plots against the normal distribution, to depict how close to normally the signature scores are distributed across the datasets, for the mean, median, and first principal component.</p>
<div class="figure">
<img src="sample_plots/sig_qq_plots_gene_sig_1.png" style="width:80.0%" alt=""><p class="caption">Plot of QQ plots for distributions of scoring metrics for gene signature 1 across datasets</p>
</div>
</div>
<div id="analysis-of-modality-of-scoring-metrics" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-of-modality-of-scoring-metrics" class="anchor"></a>Analysis of modality of scoring metrics</h3>
<p>Next, to understand the modality of the distributions of the scoring metrics across the datasets, we use the <em>mclust</em> package to compute the Bayes Information Criterion (BIC) for the likelihood of different Gaussian mixture models. The files called ’sig_gaussian_mixture_model_*.pdf’ provide plots of the modality on the x axis for each type of considered Gaussian mixture model, and the corresponding BIC on the y-axis.</p>
<p>Note that we have also provided a text output interpreting the modality for each scoring metric in each dataset/signature combination in the file ‘mixture_model_out.txt.’</p>
<p>Lastly, we save each of the raw ouptuts from the mclust call in the file ‘mixture_models_raw_out.rda’ in a list variable called <code>mixture_models</code>, with the following structure.</p>
<p><code>mixture_models[[signature_name]][[dataset_name]][[metric_type]]</code> will contain the mclust output for the Gaussian mixture model fitting for the metric_type (one of ‘median’,‘mean’,or ‘pca1’, referring to the scoring criteria) for the dataset called ‘dataset_name’ and the signature called ‘signature_name.’</p>
<div class="figure">
<img src="sample_plots/sig_gaussian_mixture_model_gene_sig_1.png" style="width:80.0%" alt=""><p class="caption">Plot of BIC vs modality for Gaussian mixture models of scoring metric distributions across datasets</p>
</div>
</div>
</div>
<div id="step-7-analysis-of-data-standardisation-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#step-7-analysis-of-data-standardisation-effects" class="anchor"></a>Step 7: Analysis of data standardisation effects</h2>
<p>To study data standardisation effects, load the output file called ‘sig_standardisation_comp.pdf.’. This plot provides the comparison of median of gene signature expression on the raw data provided versus the median of the gene signature expression on the z-transformed (standardised to zero mean and unit variance) dataset, for each sample in each dataset and each gene signature under consideration.</p>
<div class="figure">
<img src="sample_plots/sig_standardisation_comp.png" style="width:80.0%" alt=""><p class="caption">Plot of median vs. Z-transformed median score for gene signature and dataset combinations</p>
</div>
</div>
<div id="step-8-analysis-of-signature-compactness" class="section level2">
<h2 class="hasAnchor">
<a href="#step-8-analysis-of-signature-compactness" class="anchor"></a>Step 8: Analysis of signature compactness</h2>
<p>The files produced in the output directory called ‘sig_autocor_hmaps.pdf’ and ‘sig_autocor_dens.pdf’ provide heatmap and kernel density estimate plots of the correlation of each signature genes’ expression with the expression of every other signature gene, providing an analysis of signature compactness.</p>
<p>In addition to these plots produced for the analysis of autocorrelation, the files ‘sig_autocor_rankProd_*.pdf’ are produced when there is more than one dataset present for a given gene signature (not shown for this analysis). These plots represent the output of the BioConductor RankProduct package in the evaluation of signature genes whose median autocorrelation with all other genes consistently ranks low with the other signature genes. This facilitates the process for finding genes with consistent poor autocorrelation with the other genes of the gene signature, particularly when refining a given signature for optimal performance across a number of different datasets (e.g. multiple clinical cohorts, or clinical data and cell line data).</p>
<div class="figure">
<img src="sample_plots/sig_autocor_hmps.png" style="width:80.0%" alt=""><p class="caption">Plot of autocorrelation heatmaps for gene signature and dataset combinations</p>
</div>
</div>
<div id="step-9-analysis-of-signature-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#step-9-analysis-of-signature-structure" class="anchor"></a>Step 9: Analysis of signature structure</h2>
<p>Firstly, signature structure can be evaluated by hierarchical clustering on the provided expression values of the signature elements over all samples, in conjunction with annotations for the samples, if they are provided. These plots are present in the output directory and are named ‘sig_eval_struct_clustering_*.pdf,’ which are clustered based on each dataset in turn, and run over each signature and each dataset present.</p>
<div class="figure">
<img src="sample_plots/sig_eval_struct_clustering_dataset_1_gene_sig_1.png" style="width:80.0%" alt=""><p class="caption">Plot of signature gene expression across samples for gene signature 1</p>
</div>
<p>In addition to hierarchical clustering on patient samples and signature genes, in the output directory of {}, biclustering results can be found if there is a case of biclustering found among the sample groups and signature genes are found (not shown for this analysis). The particular details of the biclustering outputs and algorithm used may be found in the R Package documentation. If no biclusters are found, the files ‘sig_eval_bivariate_clustering.pdf’ are not produced.</p>
</div>
<div id="step-10-optional-comparison-of-multiple-signatures" class="section level2">
<h2 class="hasAnchor">
<a href="#step-10-optional-comparison-of-multiple-signatures" class="anchor"></a>Step 10: Optional: Comparison of multiple signatures</h2>
<p>The file produced, named ‘sig_radarplot.pdf’ describes each signature applied to each dataset in a holistic, radar chart format. This plot evaluates the gene signature across a number of QC metrics, many of which are summary metrics for those in steps 4-9 of this procedure, and these are described in detail in the Table below.</p>
<div class="figure">
<img src="sample_plots/sig_radarplot.png" style="width:80.0%" alt=""><p class="caption">Radar plot of signature metrics summarising results of QC for each dataset/signature combination</p>
</div>
</div>
<div id="step-11-optional-analysis-of-null-distributions-of-sigqc-metrics-resulting-in-longer-runtimes" class="section level2">
<h2 class="hasAnchor">
<a href="#step-11-optional-analysis-of-null-distributions-of-sigqc-metrics-resulting-in-longer-runtimes" class="anchor"></a>Step 11: Optional: Analysis of null distributions of <em>sigQC</em> metrics (resulting in longer runtimes)</h2>
<p>The file produced called ‘boxplot_metrics.pdf,’ (not produced in this example) in the negative_control subfolder of the results output shows the distributions of each of the fourteen summary metrics as reported in the radar plot for each signature and dataset combination. These distributions are generated for the number of repeats as specified by the input parameter numResampling, with default set to 50. The values for the gene signature and dataset combination in question are shown in red overlaid with the other points in grey, giving a sense of significance of each of the metrics.</p>
<p>In addition, the file produced called ‘boxplot_metrics.pdf’ (not produced in this example) in the permutation_control subfolder of the results output shows the distributions of each of the fourteen summary metrics for each signature and dataset combination as well. These distributions are produced by permuting the gene labels for each sample, for each of the signature genes present in each dataset. The number of times this process is done is given by the input parameter numResampling, with default set to 50. As with the random gene signatures, the values for the gene signature and dataset combination in question are shown in red overlaid with the other points in grey. These metrics help provide an interpretation of the gene signature’s significance with respect to resampling among the same genes, to generate another set of null distributions that can be used in the evaluation of a gene signature.</p>
</div>
</div>
<div id="metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#metrics" class="anchor"></a>Metrics</h1>
<p>The radarplot produced has 14 axes, each representative of one of the following metrics, which we outline here (for further details, see reference [1]):</p>
<ul>
<li><p><strong>Relative Med. SD</strong>: Relative median standard deviation of signature genes as compared median standard deviation of all genes. Consider the standard deviation of all signature elements’ expression across all samples, then consider the median of this list, <span class="math inline">\(\alpha\)</span>. Similarly consider the median of the standard deviation of all reported genes across all samples, <span class="math inline">\(\beta\)</span>. Value considered is <span class="math inline">\(|\alpha / (\alpha + \beta)|\)</span>, where <span class="math inline">\(|.|\)</span> represents the absolute value.</p></li>
<li><p><strong><span class="math inline">\(\rho_{Med., Z-Med.}\)</span></strong>: Absolute correlation coefficient of median of signature genes and median of signature genes on z-transformed dataset. Absolute value of Spearman correlation coefficient between median and z-median of signature elements, used as scoring metrics across samples.</p></li>
<li><p><strong><span class="math inline">\(\rho_{Mean, PCA1}\)</span></strong>: Absolute correlation coefficient of mean and first principal component of signature genes. Absolute value of Spearman correlation coefficient between mean and first principal component of signature elements, used as scoring metrics across samples.</p></li>
<li><p><strong><span class="math inline">\(\rho_{PCA1, Med.}\)</span></strong>: Absolute correlation coefficient of first principal component and median of signature genes. Absolute value of Spearman correlation coefficient between first principal component and z-median of signature elements, used as scoring metrics across samples.</p></li>
<li><p><strong><span class="math inline">\(\rho_{Mean, Med.}\)</span></strong>: Absolute correlation coefficient of mean and median of signature genes. Absolute value of Spearman correlation coefficient between mean and median of signature elements, used as scoring metrics across samples.</p></li>
<li><p><strong>Autocor.</strong>: Median of autocorrelation values for all signature genes. Median of list of all correlation coefficients for each signature element with every other signature element.</p></li>
<li><p><strong>Prop. Expressed</strong>: Median proportion of samples expressing signature genes above threshold. Median value of list of proportions of samples expressing each signature element above threshold for each signature element. Threshold is defined as median of expression of all genes, if not user-specified.</p></li>
<li><p><strong>Non-NA Prop.</strong>: Median over all samples expressing each element as non-NA. Median value of list of proportions of samples which have expression not recorded as NA, for each signature element.</p></li>
<li><p><strong>Coef. of Var.</strong>: Median coefficient of variation of all signature genes, relative to the median coefficient of variation of all genes. Consider the coefficient of variation of all signature elements across all samples, then consider the median of this list, <span class="math inline">\(\alpha\)</span>. Similarly consider the median of the coefficient of variation of all reported genes across all samples, <span class="math inline">\(\beta\)</span>. Value considered is <span class="math inline">\(|\alpha / ( \alpha + \beta )|\)</span>, where <span class="math inline">\(|.|\)</span> represents the absolute value.</p></li>
<li><p><strong><span class="math inline">\(\sigma_{\ge 50\%}\)</span></strong>: Proportion of signature genes in the top 50% of all varying genes. This is the proportion of signature elements that have coefficients of variation in the top 50% of all coefficients of variation for all genes.</p></li>
<li><p><strong><span class="math inline">\(\sigma_{\ge 25\%}\)</span></strong>: Proportion of signature genes in the top 25% of all varying genes. This is the proportion of signature elements that have coefficients of variation in the top 25% of all coefficients of variation for all genes.</p></li>
<li><p><strong><span class="math inline">\(\sigma_{\ge 10\%}\)</span></strong>: Proportion of signature genes in the top 10% of all varying genes. This is the proportion of signature elements that have coefficients of variation in the top 10% of all coefficients of variation for all genes.</p></li>
<li><p><strong>Skewness</strong>: Relative skew of distribution of signature gene expression over all samples compared with skewness of overall expression distribution for all genes. Consider the skewness of the distribution for the mean expression of all signature elements across all samples, <span class="math inline">\(\alpha\)</span>. Similarly consider the skewness of the distribution for the mean expression of all genes across all samples, <span class="math inline">\(\beta\)</span>. Value considered is <span class="math inline">\(|\alpha |/(|\alpha | + |\beta|)\)</span>, where <span class="math inline">\(|.|\)</span> represents the absolute value.</p></li>
<li><p><strong><span class="math inline">\(\sigma_{PCA1}\)</span></strong>: Proportion of gene signature score taken by median, by first principal component. This is the proportion of the variance of gene signature score that is explained by the first principal component of the expression of the signature genes taken across all samples.</p></li>
</ul>
</div>
<div id="troubleshooting" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h1>
<div id="imagemagick-dependency" class="section level2">
<h2 class="hasAnchor">
<a href="#imagemagick-dependency" class="anchor"></a>Imagemagick dependency</h2>
<p>Issues may be experienced if the ‘ImageMagick’ dependency is not installed on the user’s system (particularly for Windows systems). To install this dependency, please follow directions at: <a href="http://imagemagick.org/script/download.php" class="uri">http://imagemagick.org/script/download.php</a>.</p>
</div>
<div id="rstudio-plot-size-issue" class="section level2">
<h2 class="hasAnchor">
<a href="#rstudio-plot-size-issue" class="anchor"></a>RStudio plot size issue</h2>
<p>There is a known issue with RStudio plot size being too small causing errors with the plots being produced, even if they are not displayed in RStudio. The error in this case will appear in the log file as: <code>Error in graphics::plot.new(): figure margins too large</code>.</p>
<p>In this case, expand the plot size in the RStudio editor, and also click the maximise button on the plot window of RStudio, and re-run the package.</p>
</div>
<div id="input-data-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data-specifications" class="anchor"></a>Input data specifications</h2>
<ul>
<li>Gene signatures must be formatted as a <strong>list</strong> of matrices, of dimension <span class="math inline">\(k\)</span> rows by 1 column, for a signature of length <span class="math inline">\(k\)</span> genes. Inputting a single list as a vector will cause an error to the program.</li>
<li>Datasets must also be formatted as a <strong>list</strong> of matrices, such that genes are the rownames of the dataset, and samples are organised by columns of the dataset.</li>
<li>Gene signatures and datasets must be annotated in the same way, as if the names of the genes of a signature are not found in a dataset, the computation will not continue.</li>
<li>Care must be taken to ensure that NA valued genes are removed as optimally as possible, as if there are too many values in the expression matrix for the gene signature are NA, calculations dependent upon singular value decomposition (e.g. principal components analysis) cannot be carried out.</li>
</ul>
</div>
</div>
<div id="dependencies" class="section level1">
<h1 class="hasAnchor">
<a href="#dependencies" class="anchor"></a>Dependencies</h1>
<p>The <em>sigQC</em> package depends on having installed versions of the following packages, and R <span class="math inline">\(\ge\)</span> 3.3.0</p>
<ul>
<li>MASS<br>
</li>
<li>lattice</li>
<li>KernSmooth</li>
<li>cluster</li>
<li>nnet</li>
<li>class</li>
<li>gridGraphics</li>
<li>biclust</li>
<li>gplots</li>
<li>ComplexHeatmap</li>
<li>RankProd</li>
<li>fmsb</li>
<li>moments</li>
<li>grDevices</li>
<li>graphics</li>
<li>stats</li>
<li>utils</li>
<li>mclust</li>
<li>GSVA</li>
<li>Imagemagick</li>
</ul>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ol style="list-style-type: decimal">
<li>Dhawan, A., Barberis, A., Cheng, W.C., Domingo, E., West, C., Maughan, T., Scott, J., Harris, A.L. and Buffa, F.M., 2017. sigQC: A procedural approach for standardising the evaluation of gene signatures. <em>bioRxiv</em>, p.203729.</li>
</ol>
<!-- ## Styles --><!-- The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows: --><!--     output:  --><!--       rmarkdown::html_vignette: --><!--         css: mystyles.css --><!-- ## Figures --><!-- The figure sizes have been customised so that you can easily put two images side-by-side.  --><!-- ```{r, fig.show='hold'} --><!-- plot(1:10) --><!-- plot(10:1) --><!-- ``` --><!-- You can enable figure captions by `fig_caption: yes` in YAML: --><!--     output: --><!--       rmarkdown::html_vignette: --><!--         fig_caption: yes --><!-- Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**. --><!-- ## More Examples --><!-- You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`. --><!-- ```{r, echo=FALSE, results='asis'} --><!-- knitr::kable(head(mtcars, 10)) --><!-- ``` --><!-- Also a quote using `>`: --><!-- > "He who gives up [code] safety for [code] speed deserves neither." --><!-- ([via](https://twitter.com/hadleywickham/status/504368538874703872)) -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andrew Dhawan, Alessandro Barberis, Wei-Chen Cheng, Francesca Buffa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
